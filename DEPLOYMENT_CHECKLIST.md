# ‚úÖ Checklist –¥–ª—è –¥–µ–ø–ª–æ—è –≤ Production

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ö–†–ò–¢–ò–ß–ù–û)

### 1. –ó–∞—â–∏—Ç–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
- [ ] **–í–ê–ñ–ù–û**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `.env` –ù–ï –∑–∞–∫–æ–º–º–∏—á–µ–Ω –≤ Git
  ```bash
  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—Ä–∏—é Git
  git log --all --full-history -- .env

  # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω - —É–¥–∞–ª–∏—Ç–µ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
  git filter-branch --force --index-filter \
    "git rm --cached --ignore-unmatch .env" \
    --prune-empty --tag-name-filter cat -- --all
  ```

- [ ] **–†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤**: –ï—Å–ª–∏ `.env` –±—ã–ª –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
  - –°–º–µ–Ω–∏—Ç–µ `CLIENT_SECRET` –≤ WarcraftLogs Dashboard
  - –û–±–Ω–æ–≤–∏—Ç–µ `CLIENT_ID` –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
  - –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å PostgreSQL

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Railway

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Railway Dashboard:

```bash
# WarcraftLogs API
WCL_CLIENT_ID=your_client_id_here
WCL_CLIENT_SECRET=your_client_secret_here
CLIENT_ID=your_client_id_here
CLIENT_SECRET=your_client_secret_here

# PostgreSQL (Railway –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç DATABASE_URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
# –ù–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Railway PostgreSQL

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –¥–µ–±–∞–≥–∞ (–æ—Å—Ç–∞–≤—å—Ç–µ false –≤ –ø—Ä–æ–¥–µ)
SQL_DEBUG=false
```

---

## üê≥ Docker & Railway

### 3. Railway Start Command
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –≤ Railway:
```bash
uvicorn app.main:app --host 0.0.0.0 --port $PORT
```

### 4. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Docker Compose
```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ!)
cp .env.example .env  # –ï—Å–ª–∏ –µ—Å—Ç—å example —Ñ–∞–π–ª

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL
docker-compose up -d

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
docker-compose ps

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
uvicorn app.main:app --reload

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ healthcheck
curl http://localhost:8000/health
```

---

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### 5. PostgreSQL –≤ Railway

- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç–µ Railway PostgreSQL addon
- [ ] Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DATABASE_URL`
- [ ] –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç `postgresql://` –≤ `postgresql+asyncpg://`

### 6. –ú–∏–≥—Ä–∞—Ü–∏–∏ (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `init_models()`.

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î:
```python
# –í Python shell –∏–ª–∏ —á–µ—Ä–µ–∑ Railway CLI
from app.agregator.view import init_models
import asyncio
asyncio.run(init_models())
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### 7. –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
pip install -r requirements.txt

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–∏–Ω—Ç–µ—Ä (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)
# pylint app/ –∏–ª–∏ flake8 app/

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º–ø–æ—Ä—Ç—ã
python -c "from app.main import app; print('OK')"

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API —Å—Ç–∞—Ä—Ç—É–µ—Ç
uvicorn app.main:app --host 0.0.0.0 --port 8000

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ endpoints
curl http://localhost:8000/health
curl http://localhost:8000/meta/encounters_id/
curl http://localhost:8000/meta/raids_id/
```

### 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–±–æ—Ä (—Å 1 –∫–ª–∞—Å—Å–æ–º)
python -c "
from app.agregator.view import test_leaderboard
import asyncio
asyncio.run(test_leaderboard())
"
```

---

## üöÄ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ Production

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Railway URL
RAILWAY_URL="https://wowbackend-production.up.railway.app"

# Healthcheck
curl $RAILWAY_URL/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoints
curl "$RAILWAY_URL/meta/encounters_id/"
curl "$RAILWAY_URL/meta/raids_id/"
curl "$RAILWAY_URL/meta/encounters/?spec_type=dps&key_type=high"
```

### 10. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ Railway

```bash
# –í Railway Dashboard > Deployments > Logs
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫:
# ‚úÖ "–ú–æ–¥–µ–ª–∏ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã"
# ‚úÖ "Access token –ø–æ–ª—É—á–µ–Ω"
# ‚ùå –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
# ‚ùå –ù–µ—Ç 500 –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö
```

---

## üìà –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### 11. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–ª–∞—Å—Å—ã (–ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–í —Ñ–∞–π–ª–µ `app/agregator/constant.py`:

```python
WOW_CLASS_SPECS = {
    "DeathKnight": ["Blood", "Frost", "Unholy"],
    "DemonHunter": ["Havoc", "Vengeance"],  # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ
    "Druid": ["Balance", "Feral", "Guardian", "Restoration"],
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã
}

ENCOUNTERS = {
    62660: "Ara-Kara, City of Echoes",
    12830: "Eco-Dome Al'dani",  # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–¥–∑–µ–º–µ–ª—å—è
}

RAID = {
    2902: "Ulgrax the Devourer",
    2917: "The Bloodbound Horror",  # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–æ—Å—Å—ã
}
```

### 12. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Å–±–æ—Ä

**–í–ù–ò–ú–ê–ù–ò–ï**: –° –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –∫–ª–∞—Å—Å–æ–≤ —Å–±–æ—Ä –∑–∞–π–º–µ—Ç ~3-4 —á–∞—Å–∞!

```python
# –ß–µ—Ä–µ–∑ Railway CLI –∏–ª–∏ Python shell
from app.agregator.view import test_leaderboard
import asyncio
asyncio.run(test_leaderboard())
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: Rate Limit –æ—Ç RaiderIO
**–†–µ—à–µ–Ω–∏–µ**: –ö–æ–¥ —É–∂–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç 500ms –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

### –ü—Ä–æ–±–ª–µ–º–∞: Timeout –ø—Ä–∏ –¥–æ–ª–≥–æ–º —Å–±–æ—Ä–µ
**–†–µ—à–µ–Ω–∏–µ**: Railway –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç 500MB RAM –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ. –ï—Å–ª–∏ —É–ø–∏—Ä–∞–µ—Ç–µ—Å—å - –∞–ø–≥—Ä–µ–π–¥—å—Ç–µ –ø–ª–∞–Ω.

### –ü—Ä–æ–±–ª–µ–º–∞: SQL echo=True –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ª–æ–≥–∏
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `SQL_DEBUG=false` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ)

### –ü—Ä–æ–±–ª–µ–º–∞: CORS –æ—à–∏–±–∫–∏
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ `allow_origins` –≤ `app/main.py`

---

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

‚úÖ **PostgreSQL ON CONFLICT** - –≤–º–µ—Å—Ç–æ N SELECT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 1 –∑–∞–ø—Ä–æ—Å
‚úÖ **–û—Ç–∫–ª—é—á–µ–Ω echo=True** –≤ production (—á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è)
‚úÖ **Log rotation** - —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤ –Ω–µ –ø—Ä–µ–≤—ã—Å—è—Ç 50 MB (5 —Ñ–∞–π–ª–æ–≤ √ó 10 MB)
‚úÖ **Healthcheck endpoint** - `/health` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚úÖ **CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** - —Ç–æ–ª—å–∫–æ GET –º–µ—Ç–æ–¥—ã –∏ –Ω—É–∂–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
‚úÖ **.dockerignore** - —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ Docker –æ–±—Ä–∞–∑
‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ docker-compose.yml

---

## üìû Troubleshooting

### –õ–æ–≥–∏ –Ω–µ –ø–∏—à—É—Ç—Å—è
```python
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
import logging
logging.basicConfig(level=logging.DEBUG)
```

### –ë–î –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
```python
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL
import os
print(os.getenv("DATABASE_URL"))
```

### RaiderIO –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 429
```python
# –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –∑–∞–ø—Ä–æ—Å–æ–≤
# –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–µ—à–∏—Ä—É–µ—Ç –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä–æ–∫–æ–≤
```

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] `.env` –Ω–µ –≤ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- [ ] –°–µ–∫—Ä–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Railway Dashboard
- [ ] PostgreSQL addon –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ Railway
- [ ] Start command –Ω–∞—Å—Ç—Ä–æ–µ–Ω: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
- [ ] `/health` endpoint –æ—Ç–≤–µ—á–∞–µ—Ç 200 OK
- [ ] Frontend –¥–æ–º–µ–Ω—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ CORS
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
- [ ] –õ–æ–≥–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–æ–∫
- [ ] API endpoints –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**üéâ –ì–æ—Ç–æ–≤–æ –∫ Production!**
